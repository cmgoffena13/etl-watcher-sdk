

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Execution Management &mdash; Watcher SDK 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Monitoring" href="monitoring.html" />
    <link rel="prev" title="Address Management" href="address_management.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Watcher SDK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quick_start.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/quick_start.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/quick_start.html#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/quick_start.html#store-pipeline-and-address-lineage-configuration">Store Pipeline and Address Lineage Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/quick_start.html#sync-pipeline-and-address-lineage-configuration">Sync Pipeline and Address Lineage Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/quick_start.html#track-pipeline-execution">Track Pipeline Execution</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html">Core Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#etlresult">ETLResult</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#watchercontext">WatcherContext</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#executionresult">ExecutionResult</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html#pipeline-configuration">Pipeline Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#pipeline">Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#pipelineconfig">PipelineConfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#syncedpipelineconfig">SyncedPipelineConfig</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html#address-lineage">Address Lineage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#address">Address</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#addresslineage">AddressLineage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html#error-handling">Error Handling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#watcherapierror">WatcherAPIError</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/models.html#watchernetworkerror">WatcherNetworkError</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="address_management.html">Address Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="address_management.html#address-lineage-configuration">Address Lineage Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="address_management.html#loading-address-lineage">Loading Address Lineage</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Execution Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#logging-executions">Logging Executions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exception-handling">Exception Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-usage">Example Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#custom-etl-results">Custom ETL Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#etl-results">ETL Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#execution-results">Execution Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hierarchical-executions">Hierarchical Executions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#watcher-execution-context">Watcher Execution Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#active-flag">Active Flag</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a><ul>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html#trigger-timeliness-check">Trigger Timeliness Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html#trigger-freshness-check">Trigger Freshness Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html#trigger-celery-queue-check">Trigger Celery Queue Check</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="watermark_management.html">Watermark Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="watermark_management.html#incrementing-watermarks">Incrementing Watermarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="watermark_management.html#accessing-watermarks">Accessing Watermarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="watermark_management.html#watermark-data-type">Watermark Data Type</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Watcher SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Execution Management</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/executions.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="execution-management">
<h1>Execution Management<a class="headerlink" href="#execution-management" title="Link to this heading"></a></h1>
<p>This guide will walk through execution management for your pipelines.</p>
<section id="logging-executions">
<h2>Logging Executions<a class="headerlink" href="#logging-executions" title="Link to this heading"></a></h2>
<p>You can log executions by using the <code class="docutils literal notranslate"><span class="pre">track_pipeline_execution</span></code> decorator.
This will log the execution to the Watcher framework and return the execution id.
This execution id can be used to track the execution and retrieve the metrics.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">track_pipeline_execution</span></code> decorator requires the pipeline id and active status as arguments.
You can also pass in the <code class="docutils literal notranslate"><span class="pre">parent_execution_id</span></code>, <code class="docutils literal notranslate"><span class="pre">watermark</span></code>, and <code class="docutils literal notranslate"><span class="pre">next_watermark</span></code> as arguments to be logged.</p>
<section id="exception-handling">
<h3>Exception Handling<a class="headerlink" href="#exception-handling" title="Link to this heading"></a></h3>
<p>The decorator handles exceptions automatically:</p>
<ul class="simple">
<li><p><strong>Unexpected exceptions</strong> are automatically caught, logged as failures in the Watcher API, and then re-raised</p></li>
<li><p><strong>Set `completed_successfully=False`</strong> for business logic failures (not exceptions)</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not catch exceptions and return <cite>ETLResult</cite>. This silences the error, make sure to
raise the exception and the decorator will automatically mark the execution as failed.</p>
</div>
</section>
<section id="example-usage">
<h3>Example Usage<a class="headerlink" href="#example-usage" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">watcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">Watcher</span><span class="p">,</span> <span class="n">WatcherContext</span>

<span class="n">watcher</span> <span class="o">=</span> <span class="n">Watcher</span><span class="p">(</span><span class="s2">&quot;https://api.watcher.example.com&quot;</span><span class="p">)</span>

<span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span>
    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">etl_pipeline</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Your ETL logic here</span>
        <span class="k">if</span> <span class="n">some_condition_fails</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span><span class="n">completed_successfully</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">execution_metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Data quality issues&quot;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span><span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inserts</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Don&#39;t catch exceptions - let them bubble up to the decorator</span>
        <span class="c1"># The decorator will automatically mark the execution as failed</span>
        <span class="k">raise</span> <span class="n">e</span>

<span class="c1"># Access results</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">etl_pipeline</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">watcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">Watcher</span><span class="p">,</span> <span class="n">WatcherContext</span>

<span class="n">watcher</span> <span class="o">=</span> <span class="n">Watcher</span><span class="p">(</span><span class="s2">&quot;https://api.watcher.example.com&quot;</span><span class="p">)</span>

<span class="n">synced_config</span> <span class="o">=</span> <span class="n">watcher</span><span class="o">.</span><span class="n">sync_pipeline_config</span><span class="p">(</span><span class="n">MY_ETL_PIPELINE_CONFIG</span><span class="p">)</span>

<span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span>
    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_pipeline</span><span class="p">():</span>


    <span class="c1"># Work here</span>

    <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span>
        <span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">inserts</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">my_pipeline</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="custom-etl-results">
<h2>Custom ETL Results<a class="headerlink" href="#custom-etl-results" title="Link to this heading"></a></h2>
<p>You can extend <code class="docutils literal notranslate"><span class="pre">ETLResult</span></code> with custom fields to return additional data from your pipeline:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">watcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">ETLResult</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomETLResult</span><span class="p">(</span><span class="n">ETLResult</span><span class="p">):</span>
    <span class="n">data_quality_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span>
    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_pipeline</span><span class="p">():</span>

    <span class="c1"># ... do work ...</span>

    <span class="k">return</span> <span class="n">CustomETLResult</span><span class="p">(</span>
        <span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">inserts</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">data_quality_score</span><span class="o">=</span><span class="mf">0.95</span>
    <span class="p">)</span>

<span class="c1"># Access custom fields</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">my_pipeline</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quality score: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">data_quality_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Custom fields are only accessible in your application code. Only the standard ETLResult fields
(completed_successfully, inserts, updates, etc.) are sent to the Watcher API.</p>
</div>
</section>
<section id="etl-results">
<h2>ETL Results<a class="headerlink" href="#etl-results" title="Link to this heading"></a></h2>
<p>The ETLResult is a class that is required to be returned from your pipeline function
if using the <code class="docutils literal notranslate"><span class="pre">track_pipeline_execution</span></code> decorator.
It contains the metrics for your pipeline that are logged to the Watcher framework.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ETLResult</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">completed_successfully</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">inserts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">updates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">soft_deletes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">total_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">execution_metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>Code Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">watcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">ETLResult</span>

<span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span>
    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_pipeline</span><span class="p">():</span>


    <span class="c1"># Work here</span>

    <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span>
        <span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">inserts</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="execution-results">
<h2>Execution Results<a class="headerlink" href="#execution-results" title="Link to this heading"></a></h2>
<p>The ExecutionResults is a class that is returned from your pipeline function. This
wraps around the ETLResult class and adds the execution id. This is to ensure access
to the execution id for any usage.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">watcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionResult</span>

<span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span>
    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_pipeline</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ExecutionResult</span><span class="p">:</span>

    <span class="c1"># Work here</span>

    <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span>
            <span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">inserts</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">my_pipeline</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">execution_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">inserts</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="hierarchical-executions">
<h2>Hierarchical Executions<a class="headerlink" href="#hierarchical-executions" title="Link to this heading"></a></h2>
<p>For parent-child execution relationships, you have two options:</p>
<p><strong>Option 1: track_child_pipeline_execution() method (Recommended)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">etl_watcher_sdk</span><span class="w"> </span><span class="kn">import</span> <span class="n">Watcher</span><span class="p">,</span> <span class="n">ETLResult</span><span class="p">,</span> <span class="n">WatcherContext</span>

<span class="n">watcher</span> <span class="o">=</span> <span class="n">Watcher</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;your-api-key&quot;</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">process_ticker_data</span><span class="p">(</span><span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">watcher_context</span><span class="p">:</span> <span class="n">WatcherContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ETLResult</span><span class="p">:</span>
    <span class="c1"># Child function that processes individual ticker data</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> with watermark: </span><span class="si">{</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">watermark</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span>
        <span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">inserts</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">execution_metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ticker&quot;</span><span class="p">:</span> <span class="n">ticker</span><span class="p">,</span> <span class="s2">&quot;batch_id&quot;</span><span class="p">:</span> <span class="s2">&quot;123&quot;</span><span class="p">}</span>
    <span class="p">)</span>

<span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span><span class="n">pipeline_id</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main_etl_pipeline</span><span class="p">(</span><span class="n">watcher_context</span><span class="p">:</span> <span class="n">WatcherContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ETLResult</span><span class="p">:</span>
    <span class="n">tickers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AAPL&quot;</span><span class="p">,</span> <span class="s2">&quot;GOOGL&quot;</span><span class="p">,</span> <span class="s2">&quot;MSFT&quot;</span><span class="p">]</span>
    <span class="n">total_processed</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
        <span class="c1"># One line - calls function and tracks as child execution</span>
        <span class="n">child_result</span> <span class="o">=</span> <span class="n">watcher</span><span class="o">.</span><span class="n">track_child_pipeline_execution</span><span class="p">(</span>
            <span class="n">pipeline_id</span><span class="o">=</span><span class="mi">456</span><span class="p">,</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">parent_execution_id</span><span class="o">=</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">execution_id</span><span class="p">,</span>
            <span class="n">func</span><span class="o">=</span><span class="n">process_ticker_data</span><span class="p">,</span>
            <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
            <span class="n">watermark</span><span class="o">=</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">watermark</span><span class="p">,</span>
            <span class="n">next_watermark</span><span class="o">=</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">next_watermark</span>
        <span class="p">)</span>

        <span class="n">total_processed</span> <span class="o">+=</span> <span class="n">child_result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">total_rows</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Child execution </span><span class="si">{</span><span class="n">child_result</span><span class="o">.</span><span class="n">execution_id</span><span class="si">}</span><span class="s2"> processed </span><span class="si">{</span><span class="n">child_result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">total_rows</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span><span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total_rows</span><span class="o">=</span><span class="n">total_processed</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function that is called by <code class="docutils literal notranslate"><span class="pre">track_child_pipeline_execution</span></code>
must return an <code class="docutils literal notranslate"><span class="pre">ETLResult</span></code> or a model that inherits from <code class="docutils literal notranslate"><span class="pre">ETLResult</span></code>.
It also must not be decorated with <code class="docutils literal notranslate"><span class="pre">track_pipeline_execution</span></code>.</p>
</div>
<p><strong>Option 2: Nested decorators (for small functions)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span><span class="n">pipeline_id</span><span class="o">=</span><span class="n">parent_pipeline_id</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parent_pipeline</span><span class="p">(</span><span class="n">watcher_context</span><span class="p">:</span> <span class="n">WatcherContext</span><span class="p">):</span>
    <span class="c1"># Parent logic here</span>

    <span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span>
        <span class="n">pipeline_id</span><span class="o">=</span><span class="n">child_pipeline_id</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">parent_execution_id</span><span class="o">=</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">execution_id</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">child_pipeline</span><span class="p">():</span>
        <span class="c1"># Child logic here</span>
        <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span><span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">child_pipeline</span><span class="p">()</span>  <span class="c1"># Call the child</span>
    <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span><span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">total_rows</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Method Parameters (Option 1):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pipeline_id</span></code> (int) - ID of the child pipeline (from child config)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">active</span></code> (bool) - Whether the pipeline is active (from child config)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parent_execution_id</span></code> (int) - ID of the parent execution (from watcher_context)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">func</span></code> (callable) - Function to execute as child execution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code> - Arguments to pass to the function</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">watermark</span></code> (optional) - Watermark to pass to the child execution (from child config)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next_watermark</span></code> (optional) - Next watermark to pass to the child execution (from child config)</p></li>
</ul>
<p><strong>Key Features:</strong></p>
<ul class="simple">
<li><p><strong>Automatic WatcherContext injection</strong> - If your function has a <cite>watcher_context</cite> parameter, it gets injected automatically</p></li>
<li><p><strong>Full ETLResult logging</strong> - Captures and logs all metrics (inserts, updates, total_rows, etc.)</p></li>
<li><p><strong>Error handling</strong> - Automatically marks as failed if exception occurs</p></li>
<li><p><strong>Watermark support</strong> - Child functions can access watermarks via <cite>watcher_context</cite></p></li>
</ul>
</section>
<section id="watcher-execution-context">
<h2>Watcher Execution Context<a class="headerlink" href="#watcher-execution-context" title="Link to this heading"></a></h2>
<p>The WatcherContext is a class that is passed to your pipeline function.
It contains the execution id, pipeline id, watermark, and next watermark variables.
Your function must have <cite>watcher_context</cite> as a parameter if using the WatcherContext.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">watcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">WatcherContext</span>

<span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span>
    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_pipeline</span><span class="p">(</span><span class="n">watcher_context</span><span class="p">:</span> <span class="n">WatcherContext</span><span class="p">):</span>

    <span class="c1"># Work here</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">execution_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">pipeline_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">watermark</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">watcher_context</span><span class="o">.</span><span class="n">next_watermark</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span>
        <span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">inserts</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="active-flag">
<h2>Active Flag<a class="headerlink" href="#active-flag" title="Link to this heading"></a></h2>
<p>You can set a Pipeline’s active flag to False to skip the execution. This is normally triggered
through the Watcher framework directly as the active flag is received from the Watcher API.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@watcher</span><span class="o">.</span><span class="n">track_pipeline_execution</span><span class="p">(</span>
    <span class="n">pipeline_id</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="n">synced_config</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_pipeline</span><span class="p">(</span><span class="n">watcher_context</span><span class="p">:</span> <span class="n">WatcherContext</span><span class="p">):</span>

    <span class="c1"># Function IS SKIPPED if active is False</span>

    <span class="k">return</span> <span class="n">ETLResult</span><span class="p">(</span>
        <span class="n">completed_successfully</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">inserts</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">total_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">my_pipeline</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This can be a useful functionality to use in your pipelines to skip executions if needed.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="address_management.html" class="btn btn-neutral float-left" title="Address Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="monitoring.html" class="btn btn-neutral float-right" title="Monitoring" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Cortland Goffena.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>